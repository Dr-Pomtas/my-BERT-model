<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>å‹•ç‰©ç—…é™¢å£ã‚³ãƒŸåˆ†æã‚·ã‚¹ãƒ†ãƒ  - æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <!-- 1. Canvaså††ã‚°ãƒ©ãƒ•ãƒ†ã‚¹ãƒˆ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>1. Canvaså††ã‚°ãƒ©ãƒ•ãƒ†ã‚¹ãƒˆ</h5>
            </div>
            <div class="card-body">
                <div id="testStarChart"></div>
                <button class="btn btn-primary" onclick="testStarChart()">å††ã‚°ãƒ©ãƒ•è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>
        
        <!-- 2. ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ¯”è¼ƒè¡¨ãƒ†ã‚¹ãƒˆ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>2. ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ¯”è¼ƒè¡¨ãƒ†ã‚¹ãƒˆ</h5>
            </div>
            <div class="card-body">
                <div id="testModelChart"></div>
                <button class="btn btn-success" onclick="testModelChart()">æ€§èƒ½æ¯”è¼ƒè¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>
        
        <!-- 3. ç—…é™¢åˆ¥åˆ†æãƒ†ã‚¹ãƒˆ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>3. ç—…é™¢åˆ¥åˆ†æãƒ†ã‚¹ãƒˆ</h5>
            </div>
            <div class="card-body">
                <div id="testHospitalAnalysis"></div>
                <button class="btn btn-warning" onclick="testHospitalAnalysis()">ç—…é™¢åˆ†æè¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>
    </div>

    <script>
        // 1. Canvaså††ã‚°ãƒ©ãƒ•ãƒ†ã‚¹ãƒˆ
        function testStarChart() {
            const ctx = document.getElementById('testStarChart');
            const starData = {'1': 100, '2': 150, '3': 300, '4': 800, '5': 650};
            
            const total = Object.values(starData).reduce((sum, count) => sum + count, 0);
            
            // Canvasã‚’ä½œæˆ
            ctx.innerHTML = '';
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 400;
            ctx.appendChild(canvas);
            
            // ç°¡å˜ãªå††ã‚°ãƒ©ãƒ•ã‚’æç”»
            const context = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            
            const colors = ['#dc3545', '#fd7e14', '#ffc107', '#198754', '#20c997'];
            let currentAngle = 0;
            
            context.clearRect(0, 0, canvas.width, canvas.height);
            
            ['1', '2', '3', '4', '5'].forEach((rating, index) => {
                const count = starData[rating] || 0;
                const angle = total > 0 ? (count / total) * 2 * Math.PI : 0;
                
                if (angle > 0) {
                    // å††ã‚°ãƒ©ãƒ•ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æç”»
                    context.beginPath();
                    context.arc(centerX, centerY, radius, currentAngle, currentAngle + angle);
                    context.lineTo(centerX, centerY);
                    context.fillStyle = colors[index];
                    context.fill();
                    context.strokeStyle = '#fff';
                    context.lineWidth = 2;
                    context.stroke();
                    currentAngle += angle;
                }
            });
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¿½åŠ 
            context.fillStyle = '#000';
            context.font = '18px Arial';
            context.textAlign = 'center';
            context.fillText('æ˜Ÿè©•ä¾¡åˆ†å¸ƒãƒ†ã‚¹ãƒˆ', centerX, 30);
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚è¿½åŠ 
            let tableHtml = `
                <table class="table table-sm table-striped mt-3 mb-0">
                    <thead>
                        <tr><th>æ˜Ÿè©•ä¾¡</th><th>ä»¶æ•°</th><th>å‰²åˆ</th></tr>
                    </thead>
                    <tbody>
            `;
            
            ['1', '2', '3', '4', '5'].forEach((rating, index) => {
                const count = starData[rating] || 0;
                const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                tableHtml += `<tr>
                    <td><span style="color: ${colors[index]};">â˜…${rating}</span></td>
                    <td>${count}ä»¶</td>
                    <td>${percentage}%</td>
                </tr>`;
            });
            
            tableHtml += '</tbody></table>';
            const tableDiv = document.createElement('div');
            tableDiv.innerHTML = tableHtml;
            ctx.appendChild(tableDiv);
        }
        
        // 2. ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ¯”è¼ƒè¡¨ãƒ†ã‚¹ãƒˆ
        function testModelChart() {
            const ctx = document.getElementById('testModelChart');
            const modelData = {
                'Model A (Koheiduck)': { mae: 0.5542, correlation: 0.3416 },
                'Model B (LLM-book)': { mae: 0.1835, correlation: 0.3897 },
                'Model C (Mizuiro)': { mae: 0.7862, correlation: 0.3376 }
            };
            
            const models = Object.keys(modelData);
            let tableHtml = `
                <div class="alert alert-info">
                    <h6><i class="fas fa-chart-bar me-2"></i>ãƒ¢ãƒ‡ãƒ«æ€§èƒ½æ¯”è¼ƒ (ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º)</h6>
                    <table class="table table-sm table-striped mt-2 mb-0">
                        <thead>
                            <tr><th>ãƒ¢ãƒ‡ãƒ«</th><th>MAE</th><th>ç›¸é–¢ä¿‚æ•°</th><th>æ€§èƒ½</th></tr>
                        </thead>
                        <tbody>
            `;
            
            // MAEã§ã‚½ãƒ¼ãƒˆï¼ˆæ˜‡é †ï¼‰
            const sortedModels = models.sort((a, b) => (modelData[a].mae || 0) - (modelData[b].mae || 0));
            
            sortedModels.forEach((model, index) => {
                const data = modelData[model];
                const mae = data.mae || 0;
                const correlation = data.correlation || 0;
                const rank = index + 1;
                const rankIcon = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
                
                tableHtml += `<tr>
                    <td><strong>${model}</strong></td>
                    <td>${mae.toFixed(4)}</td>
                    <td>${correlation.toFixed(3)}</td>
                    <td>${rankIcon} ${rank}ä½</td>
                </tr>`;
            });
            
            tableHtml += '</tbody></table></div>';
            ctx.innerHTML = tableHtml;
        }
        
        // 3. ç—…é™¢åˆ¥åˆ†æãƒ†ã‚¹ãƒˆ
        function testHospitalAnalysis() {
            const ctx = document.getElementById('testHospitalAnalysis');
            const hospitalData = {
                'H001': {
                    'review_count': 40,
                    'avg_rating': 3.6,
                    'avg_sentiment': 0.145,
                    'Model A (Koheiduck)_score': 0.234,
                    'Model B (LLM-book)_score': 0.156,
                    'Model C (Mizuiro)_score': 0.045
                },
                'H002': {
                    'review_count': 35,
                    'avg_rating': 4.2,
                    'avg_sentiment': 0.287,
                    'Model A (Koheiduck)_score': 0.345,
                    'Model B (LLM-book)_score': 0.289,
                    'Model C (Mizuiro)_score': 0.227
                }
            };
            
            let html = `
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-hospital me-2"></i>ç—…é™¢åˆ¥åˆ†æçµæœ</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ç—…é™¢ID</th>
                                        <th>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°</th>
                                        <th>å¹³å‡æ˜Ÿè©•ä¾¡</th>
                                        <th>Koheiduck</th>
                                        <th>LLM-book</th>
                                        <th>Mizuiro</th>
                                        <th>å¹³å‡æ„Ÿæƒ…ã‚¹ã‚³ã‚¢</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            Object.entries(hospitalData).forEach(([hospitalId, data]) => {
                const avgRating = data.avg_rating || 0;
                const koheiduck = data['Model A (Koheiduck)_score'] || 0;
                const llmbook = data['Model B (LLM-book)_score'] || 0;
                const mizuiro = data['Model C (Mizuiro)_score'] || 0;
                
                html += `
                    <tr>
                        <td><strong>${hospitalId}</strong></td>
                        <td>${data.review_count}ä»¶</td>
                        <td>${avgRating.toFixed(2)}ç‚¹</td>
                        <td><span class="badge bg-primary">${koheiduck.toFixed(3)}</span></td>
                        <td><span class="badge bg-success">${llmbook.toFixed(3)}</span></td>
                        <td><span class="badge bg-warning">${mizuiro.toFixed(3)}</span></td>
                        <td><strong>${data.avg_sentiment.toFixed(3)}</strong></td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            ctx.innerHTML = html;
        }
    </script>
</body>
</html>