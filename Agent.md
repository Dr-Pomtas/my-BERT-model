# Agent.md: 動物病院の口コミ評価と経営意識に関する研究計画書

## 1. 研究目的と概要 (Research Purpose and Overview)

本研究の目的は、動物病院の経営者の経営方針や経営状況が、Googleマップ上のオンライン評価（星評価および口コミテキスト）にどのような影響を与えるかを統計的に解明することである。

そのために、以下の2段階の分析プロセスを実行する。

1.  **フェーズ1: 最適な感情分析モデルの選定**
    * 複数のオープンソースBERTモデルを用い、本研究の分析対象である「動物病院の口コミ」に対して最も人間の評価（星評価）と相関の高いモデルを客観的な指標に基づき選定する。

2.  **フェーズ2: 本分析（重回帰分析）**
    * フェーズ1で選定した最適なモデルを用いて全口コミをスコア化し、そのスコアを目的変数とする。そして、動物病院経営者へのアンケート調査から得られたデータを説明変数として重回帰分析を行い、経営意識とオンライン評価の関連性を明らかにする。

---

## 2. フェーズ1: 最適な感情分析モデルの選定

### 2.1. 使用モデル (Candidate Models)

以下の3つの日本語感情分析モデルを比較・検討の対象とする。

* `koheiduck/bert-japanese-finetuned-sentiment`
* `llm-book/bert-base-japanese-v2-finetuned-sentiment`
* `Mizuiro-inc/bert-base-japanese-finetuned-sentiment-analysis`

### 2.2. 入力データ (Input Data)

分析には以下の形式のCSVファイルを使用する。

* **A列**: 動物病院ID (`hospital_id`)
* **B列**: 口コミテキスト (`review_text`)
* **C列**: 星評価 (`star_rating`, 1〜5の整数)

### 2.3. 分析プロセス (Analysis Process)

#### Step 1: データ前処理 (Data Preprocessing)

* 各口コミテキストに対して、URL、絵文字、特殊記号の除去、および全角・半角英数字の統一などのテキストクリーニングを実施する。

#### Step 2: スコア化と正規化 (Scoring and Normalization)

1.  **口コミスコアの算出**:
    各モデルで、一行（一口コミ）ごとにポジティブ確率 `P(pos)` とネガティブ確率 `P(neg)` を算出する。これを用いて、以下の式で口コミスコアを計算する。
    $$
    \text{口コミスコア} = (P(\text{pos}) \times 2) - (P(\text{neg}) \times 2)
    $$

2.  **星評価スコアの算出**:
    1〜5の星評価を、以下の式でスコア化する。
    $$
    \text{星評価スコア} = \text{星評価} - 3
    $$

3.  **正規化**:
    上記2つの計算により、両スコアはともに**-2.0から+2.0**の範囲に正規化され、中心点 `0` が中立/平均を示す共通のスケールを持つ。

#### Step 3: 病院単位での集計 (Aggregation by Hospital)

* 動物病院ID (`hospital_id`) でデータをグループ化し、各病院の「平均口コミスコア」と「平均星評価スコア」を算出する。以降のモデル評価は、この集計後のデータを用いて行う。

#### Step 4: モデル性能評価 (Model Performance Evaluation)

各モデルの「平均口コミスコア」と、ベンチマークとなる「平均星評価スコア」との関連性を、以下の多角的な指標で評価する。

1.  **相関分析 (Correlation Analysis)**:
    * ピアソンおよびスピアマンの相関係数を計算し、相関の強さを比較する。
2.  **誤差分析 (Error Analysis)**:
    * 平均絶対誤差（MAE）および平均二乗誤差ルート（RMSE）を計算し、予測誤差の大きさを比較する。
3.  **統計的有意差の検証 (Statistical Significance Test)**:
    * 各モデルの相関係数間に統計的に意味のある差が存在するかを、ブートストラップ法などを用いて検証する。
4.  **質的分析 (Qualitative Analysis)**:
    * モデル間でスコアの乖離が大きかった口コミを抽出し、どのような文章で性能差が現れるかを考察する。

### 2.4. モデルの選定 (Model Selection)

* 上記の定量的・定性的な評価を総合的に判断し、本研究の目的に最も適合するモデルを1つ選定する。選定理由を明確に記録する。

---

## 3. フェーズ2: 本分析（重回帰分析）

### 3.1. 変数の設定 (Variable Definition)

* **目的変数 (Dependent Variable)**:
    * フェーズ1で選定した最適モデルによって算出された、各病院の「平均口コミスコア」。
* **説明変数 (Independent Variables)**:
    * 各病院の経営者に対して実施したアンケート調査の各項目（経営方針、経営状況など）。

### 3.2. 分析手法 (Analysis Method)

* 上記変数を用いて重回帰分析を実行し、各アンケート項目が口コミスコアに与える影響の大きさや統計的有意性を評価する。

---

## 4. 分析支援アプリケーションの要件

本研究プロセスを効率化・可視化するため、以下の機能を持つアプリケーションを開発する。

1.  **データ入力**:
    * 指定された形式のCSVファイルをアップロードする機能。
2.  **基本統計量の表示**:
    * 読み込んだデータの病院数、口コミ総数、星評価の分布（ヒストグラム）などを表示する機能。
3.  **モデル性能比較**:
    * 3モデルの「平均口コミスコア」をそれぞれ計算・表示する機能。
    * 各モデルの相関係数や誤差指標（MAE, RMSE）を棒グラフで比較表示する機能。
4.  **相関の可視化**:
    * 各モデルについて、横軸を「平均口コミスコア」、縦軸を「平均星評価スコア」とした散布図を表示する機能。グラフ内には相関係数を明記する。